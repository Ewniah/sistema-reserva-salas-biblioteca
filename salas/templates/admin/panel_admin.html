{% extends 'salas/base.html' %}

{% block title %}Panel de AdministraciÃ³n{% endblock %}

{% block content %}
<div class="card">
    <h2>âš™ï¸ Panel de AdministraciÃ³n</h2>
    <p>Bienvenido <strong>{{ user.username }}</strong> al panel de administraciÃ³n del sistema.</p>
</div>

<div class="grid grid-3 mb-4">
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #dbeafe, #bfdbfe);">
            ğŸ“š
        </div>
        <div class="stat-value">{{ total_salas }}</div>
        <div class="stat-label">Salas Totales</div>
        <div style="margin-top: 1rem; font-size: 0.875rem; color: var(--gray);">
            âœ“ {{ salas_habilitadas }} Habilitadas Â· âœ• {{ salas_deshabilitadas }} Deshabilitadas
        </div>
        <a href="{% url 'admin_salas' %}" class="btn btn-secondary btn-sm mt-3" style="width: 100%;">Gestionar Salas</a>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #d1fae5, #a7f3d0);">
            âœ“
        </div>
        <div class="stat-value">{{ reservas_activas }}</div>
        <div class="stat-label">Reservas Activas</div>
        <a href="{% url 'admin_reservas' %}" class="btn btn-secondary btn-sm mt-3" style="width: 100%;">Ver Reservas</a>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon" style="background: linear-gradient(135deg, #fef3c7, #fde68a);">
            ğŸ“Š
        </div>
        <div class="stat-value">{{ total_reservas }}</div>
        <div class="stat-label">Total Reservas</div>
        <div style="margin-top: 1rem; font-size: 0.875rem; color: var(--gray);">
            âœ“ {{ reservas_finalizadas }} Finalizadas Â· âœ• {{ reservas_canceladas }} Canceladas
        </div>
    </div>
</div>

<div class="card">
    <h3>ğŸ“‹ Ãšltimas Reservas (Todas)</h3>
    {% if ultimas_reservas %}
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Sala</th>
                        <th>Reservante</th>
                        <th>RUT</th>
                        <th>Inicio</th>
                        <th>Fin</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for reserva in ultimas_reservas %}
                        <tr>
                            <td><strong>{{ reserva.sala.nombre }}</strong></td>
                            <td>{{ reserva.nombre_reservante }}</td>
                            <td>{{ reserva.rut }}</td>
                            <td>{{ reserva.fecha_hora_inicio|date:"d/m/Y H:i" }}</td>
                            <td>{{ reserva.fecha_hora_fin|date:"d/m/Y H:i" }}</td>
                            <td>
                                {% if reserva.estado == 'activa' %}
                                    {% now "U" as current_time %}
                                    {% if reserva.fecha_hora_fin|date:"U" >= current_time %}
                                        <span class="badge badge-success">âœ“ Activa</span>
                                    {% else %}
                                        <span class="badge badge-secondary">âœ“ Finalizada</span>
                                    {% endif %}
                                {% elif reserva.estado == 'cancelada' %}
                                    <span class="badge badge-danger">âœ• Cancelada</span>
                                {% else %}
                                    <span class="badge badge-secondary">{{ reserva.estado }}</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if reserva.estado == 'activa' %}
                                    {% now "U" as current_time %}
                                    {% if reserva.fecha_hora_fin|date:"U" >= current_time %}
                                        <a href="{% url 'admin_finalizar_reserva' reserva.id %}" class="btn btn-warning btn-sm">
                                            â° Finalizar
                                        </a>
                                    {% endif %}
                                {% else %}
                                    <span style="color: var(--gray-light); font-size: 0.875rem;">â€”</span>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="text-center" style="padding: 2rem;">
            <p style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“­</p>
            <p style="color: var(--gray);">No hay reservas registradas.</p>
        </div>
    {% endif %}
</div>
{% endblock %}
