{% extends 'salas/base.html' %}

{% block title %}Panel de AdministraciÃ³n{% endblock %}

{% block content %}
<div class="card">
    <h2>Panel de AdministraciÃ³n</h2>
    <p>Bienvenido <strong>{{ user.username }}</strong> al panel de administraciÃ³n del sistema de reserva de salas.</p>
</div>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
    <div class="card" style="background-color: #e3f2fd;">
        <h3>ğŸ“š Salas Totales</h3>
        <p style="font-size: 36px; font-weight: bold; margin: 10px 0;">{{ total_salas }}</p>
        <p>Habilitadas: {{ salas_habilitadas }} | Deshabilitadas: {{ salas_deshabilitadas }}</p>
        <a href="{% url 'admin_salas' %}" class="btn btn-secondary">Gestionar Salas</a>
    </div>
    
    <div class="card" style="background-color: #fff3e0;">
        <h3>ğŸ“… Reservas Totales</h3>
        <p style="font-size: 36px; font-weight: bold; margin: 10px 0;">{{ total_reservas }}</p>
        <p>Activas: {{ reservas_activas }} | Finalizadas: {{ reservas_finalizadas }}</p>
        <a href="{% url 'admin_reservas' %}" class="btn btn-secondary">Ver Reservas</a>
    </div>
</div>

<div class="card">
    <h3>Ãšltimas Reservas</h3>
    {% if ultimas_reservas %}
        <table>
            <thead>
                <tr>
                    <th>Sala</th>
                    <th>Reservante</th>
                    <th>RUT</th>
                    <th>Inicio</th>
                    <th>Fin</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for reserva in ultimas_reservas %}
                    <tr>
                        <td>{{ reserva.sala.nombre }}</td>
                        <td>{{ reserva.nombre_reservante }}</td>
                        <td>{{ reserva.rut }}</td>
                        <td>{{ reserva.fecha_hora_inicio|date:"d/m/Y H:i" }}</td>
                        <td>{{ reserva.fecha_hora_fin|date:"d/m/Y H:i" }}</td>
                        <td>
                            {% now "U" as current_time %}
                            {% if reserva.fecha_hora_fin|date:"U" >= current_time %}
                                <span class="badge badge-success">Activa</span>
                            {% else %}
                                <span class="badge badge-secondary">Finalizada</span>
                            {% endif %}
                        </td>
                        <td>
                            {% now "U" as current_time %}
                            {% if reserva.fecha_hora_fin|date:"U" >= current_time %}
                                <a href="{% url 'admin_finalizar_reserva' reserva.id %}" 
                                   class="btn" 
                                   style="padding: 5px 10px; background-color: #ffc107; font-size: 12px;">
                                   Finalizar
                                </a>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No hay reservas registradas.</p>
    {% endif %}
</div>
{% endblock %}
